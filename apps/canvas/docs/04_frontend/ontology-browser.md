# 온톨로지 브라우저 UI

<!-- affects: frontend, api, process-designer -->
<!-- requires-update: 02_api/api-contracts.md (Synapse API), 04_frontend/process-designer.md -->

## 이 문서가 답하는 질문

- 온톨로지 브라우저의 화면 구성은 어떻게 되는가?
- Force-directed 그래프는 어떻게 렌더링하고 인터랙션하는가?
- 4계층(KPI, Measure, Process, Resource) 필터는 어떻게 동작하는가?
- K-AIR DataLineage에서 무엇이 달라지는가?
- 비즈니스 프로세스 디자이너의 EventStorming 노드와 온톨로지는 어떻게 연결되는가?

---

## 1. 화면 와이어프레임

```
┌──────────────────────────────────────────────────────────────────────┐
│ 🔗 온톨로지 브라우저                                                 │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ┌── 제어 패널 ─────────────────────────────────────────────────┐   │
│  │  🔍 노드 검색: [                              ] [검색]       │   │
│  │                                                               │   │
│  │  계층 필터:                                                    │   │
│  │  [●] KPI        [●] Measure      [●] Process    [●] Resource │   │
│  │  (빨강)          (주황)           (파랑)          (초록)       │   │
│  │                                                               │   │
│  │  깊이: [1] [2●] [3]              줌: [- ━━●━━ +]             │   │
│  └───────────────────────────────────────────────────────────────┘   │
│                                                                      │
│  ┌── 그래프 영역 ──────────────────────┐ ┌── 노드 상세 ──────────┐ │
│  │                                      │ │                        │ │
│  │            ○ 전사경영KPI             │ │ 선택된 노드:           │ │
│  │           ╱ ╲                        │ │                        │ │
│  │          ╱   ╲                       │ │ 🔵 물류 관리 프로세스  │ │
│  │    ○ 물류KPI  ○ 효율KPI             │ │                        │ │
│  │    │          │                      │ │ 계층: Process          │ │
│  │    │          │                      │ │ 유형: 핵심업무프로세스  │ │
│  │    ◎ 물류측정  ◎ 효율측정            │ │                        │ │
│  │    │          │                      │ │ ─── 속성 ───          │ │
│  │    │          │                      │ │ 담당부서: 물류관리팀   │ │
│  │    ◆ 입고처리  ◆ 배송관리            │ │ 갱신일: 2024-01-15    │ │
│  │     ╲       ╱                        │ │ 관련 데이터: 45건     │ │
│  │      ╲     ╱                         │ │                        │ │
│  │       ■ 물류센터A  ■ 운송B           │ │ ─── 연결 ───          │ │
│  │                                      │ │ → 물류측정 (측정)     │ │
│  │  ○ KPI  ◎ Measure  ◆ Process  ■ Res │ │ → 물류센터A (참여)    │ │
│  │                                      │ │ ← 물류KPI (달성)      │ │
│  │  [전체 보기] [선택 중심 정렬]        │ │                        │ │
│  └──────────────────────────────────────┘ │ [관련 케이스 보기]    │ │
│                                            │ [경로 탐색]           │ │
│                                            └────────────────────────┘ │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
```

---

## 2. 4계층 온톨로지 모델

K-AIR의 온톨로지 4계층 구조를 시각화한다.

```
┌─────────────────────────────────────────────────────┐
│  KPI 레이어 (빨강 ○)                                │
│  경영전략 목표, BSC 연계                             │
│  예: 전사경영KPI, 물류KPI, 효율KPI                   │
├─────────────────────────────────────────────────────┤
│  Measure 레이어 (주황 ◎)                            │
│  데이터 기반 업무평가 지표                            │
│  예: 물류측정, 효율측정, 비용측정                     │
├─────────────────────────────────────────────────────┤
│  Process 레이어 (파랑 ◆)                            │
│  현장업무 흐름 및 지침                                │
│  예: 입고처리, 배송관리, 재고관리                     │
├─────────────────────────────────────────────────────┤
│  Resource 레이어 (초록 ■)                           │
│  물리적 시스템, 인력, 자원                            │
│  예: 물류센터A, 운송B, 센서C                         │
└─────────────────────────────────────────────────────┘

관계 방향:
Resource ──참여──▶ Process ──측정──▶ Measure ──달성──▶ KPI
```

---

## 3. 그래프 시각화

### 3.1 React Force Graph

```typescript
// K-AIR: Mermaid (정적 다이어그램) + Cytoscape.js
// Canvas: react-force-graph-2d (인터랙티브 + 성능)

// 선택 이유:
// - WebGL 기반 대량 노드 처리 (1000+ 노드)
// - 줌/패닝/드래그 내장
// - 노드 클릭, 호버 이벤트
// - Force-directed 레이아웃 자동 계산
```

### 3.2 노드 시각 인코딩

| 계층 | 모양 | 색상 | 크기 |
|------|------|------|------|
| KPI | 원(Circle) | 빨강 `#EF4444` | 연결 수 비례 (large) |
| Measure | 다이아몬드 | 주황 `#F59E0B` | 연결 수 비례 (medium) |
| Process | 사각형 | 파랑 `#3B82F6` | 연결 수 비례 (medium) |
| Resource | 삼각형 | 초록 `#10B981` | 연결 수 비례 (small) |

### 3.3 엣지 시각 인코딩

| 관계 | 스타일 | 색상 |
|------|--------|------|
| 달성 | 실선 (두꺼움) | 빨강 |
| 측정 | 실선 | 주황 |
| 참여 | 점선 | 파랑 |
| 매핑 (DataSource) | 파선 | 회색 |

---

## 4. 인터랙션 상세

### 4.1 노드 클릭

```
노드 클릭
├── 노드 상세 패널 표시 (오른쪽)
├── 연결된 노드 하이라이트
├── 나머지 노드 흐리게 (opacity 0.3)
└── 1홉 이웃 노드만 강조
```

### 4.2 경로 탐색

```
"경로 탐색" 클릭
├── 시작 노드 선택 (클릭)
├── 끝 노드 선택 (클릭)
├── Synapse API: GET /ontology/paths?from=A&to=B&maxHops=3
├── 최단 경로 하이라이트 (굵은 엣지 + 밝은 노드)
└── 경로 상 노드 목록 표시
```

### 4.3 계층 필터

```
[●] KPI 해제 시
├── KPI 계층 노드 숨김
├── KPI와 연결된 엣지 숨김
├── Force 레이아웃 재계산
└── 나머지 노드 재배치
```

---

## 5. 컴포넌트 분해

```
OntologyPage
├── SearchPanel
│   ├── shared/SearchInput (디바운스)
│   └── SearchResults (자동완성 목록)
├── LayerFilter
│   └── Checkbox (x4 계층)
├── DepthSelector
│   └── shared/ui/Tabs (1, 2, 3)
├── GraphViewer
│   └── react-force-graph-2d
│       ├── nodeCanvasObject (커스텀 렌더링)
│       └── onNodeClick (상세 패널 연동)
├── NodeDetail
│   ├── NodeProperties
│   ├── NodeConnections (연결 목록)
│   └── RelatedActions (케이스 보기, 경로 탐색)
└── PathHighlighter
    └── 경로 시각화 오버레이
```

---

## 6. 비즈니스 프로세스 디자이너 연동

### 6.1 EventStorming -> 온톨로지 매핑

비즈니스 프로세스 디자이너(process-designer)에서 생성된 EventStorming 기반 노드는 온톨로지 4계층과 시각적으로 연결된다.

```
비즈니스 프로세스 디자이너 노드         온톨로지 계층        연결 관계
────────────────────────────         ────────────         ──────────
Measure (측정값, 보라색)          ──→  Measure 레이어       직접 매핑
Business Event (업무 사건, 주황)  ──→  Process 레이어       이벤트 → 프로세스 변환
Business Action (업무 행위, 파랑) ──→  Process 레이어       액션 → 프로세스 활동
Business Entity (업무 객체, 노랑) ──→  Resource 레이어      엔티티 → 리소스 매핑
Business Report (보고서, 연두)    ──→  KPI 레이어           보고서 → KPI 연결
Business Rule (업무 규칙, 핑크)   ──→  Process 레이어       규칙 → 프로세스 제약
```

### 6.2 프로세스 디자이너 노드의 온톨로지 브라우저 표시

온톨로지 브라우저에서 Process 계층 노드를 클릭하면, 해당 노드가 프로세스 디자이너 캔버스의 어떤 Business Event/Action과 연결되어 있는지 노드 상세 패널에 표시된다.

```
┌── 노드 상세 ──────────┐
│                        │
│ 선택된 노드:           │
│ ◆ 입고처리             │
│                        │
│ 계층: Process          │
│ 유형: 핵심업무프로세스  │
│                        │
│ ─── 프로세스 디자이너 ─│ (새 섹션)
│ 연결된 비즈니스 이벤트: │
│ ● 입고접수완료 (Event) │
│ ● 검수시작 (Action)    │
│ ● 입고확정 (Event)     │
│                        │
│ [프로세스 디자이너에서  │
│  열기 →]               │
│                        │
│ ─── 속성 ───          │
│ ...                    │
└────────────────────────┘
```

### 6.3 상호 내비게이션

```
온톨로지 브라우저                              프로세스 디자이너
┌──────────────┐  "프로세스 디자이너에서 열기"  ┌──────────────┐
│  Process 노드 │ ──────────────────────────→  │  해당 노드로  │
│  클릭 상세    │                               │  포커스+줌    │
└──────────────┘                               └──────────────┘

┌──────────────┐  "온톨로지에서 보기"           ┌──────────────┐
│  해당 Process │ ◀──────────────────────────  │  캔버스 노드  │
│  노드 하이라  │                               │  우클릭 메뉴  │
│  이트         │                               │              │
└──────────────┘                               └──────────────┘
```

이 상호 내비게이션은 URL 파라미터를 통해 구현한다:
- 온톨로지 -> 프로세스 디자이너: `/process-designer/:boardId?focus=:nodeId`
- 프로세스 디자이너 -> 온톨로지: `/ontology?highlight=:ontologyNodeId`

---

## 7. 접근성 (Accessibility)

Force-directed 그래프는 시각적/마우스 기반 UI이므로, WCAG 2.1 AA 준수를 위해 대체 접근 수단이 필수이다.

### 7.1 테이블 뷰 대체 인터페이스

그래프 뷰와 테이블 뷰를 토글할 수 있어야 한다.

```
[그래프 뷰●] [테이블 뷰]
```

테이블 뷰는 동일 데이터를 접근 가능한 형태로 표시한다:
- **노드 목록**: 이름, 계층, 유형, 연결 수를 컬럼으로 표시
- **관계 목록**: 출발 노드 → 도착 노드, 관계 유형을 표로 표시
- **경로 검색 결과**: 단계별 노드 리스트로 표시

### 7.2 그래프 뷰 키보드 내비게이션

| 키 | 동작 |
|----|------|
| `Tab` | 다음 노드로 이동 (포커스 순서: 검색 결과 → 현재 보이는 노드 순) |
| `Enter` | 포커스된 노드 선택 → 노드 상세 패널 열기 |
| `Arrow Keys` | 포커스된 노드의 이웃 노드로 이동 (방향은 공간 좌표 기준) |
| `Escape` | 선택 해제, 노드 상세 패널 닫기 |
| `+` / `-` | 줌 인/아웃 |

### 7.3 스크린 리더 지원

- 그래프 컨테이너: `role="application"` + `aria-label="온톨로지 그래프. 노드 {n}개, 관계 {m}개. Tab으로 노드 탐색"`
- 노드 포커스 시: `aria-label="{노드명}, {계층} 계층, 연결 {k}개"`
- 노드 선택 시: `aria-live="polite"` 영역에 노드 상세 정보 발표
- 경로 하이라이트: `aria-live="polite"` 영역에 경로 설명 텍스트 발표

### 7.4 색상 대체

4계층 색상 구분(빨강/주황/파랑/초록)은 색맹 사용자를 위해 **모양(shape)**으로도 구분한다:
- KPI: 빨강 + 다이아몬드(◆)
- Measure: 주황 + 삼각형(▲)
- Process: 파랑 + 원(●) — 이미 적용됨
- Resource: 초록 + 사각형(■)

---

## 8. UX 상태 설계 (에러/빈 상태/로딩)

### 8.1 에러 상태

| 시나리오 | UI 표시 | 액션 |
|---------|---------|------|
| 페이지 로드 실패 | ErrorFallback (implementation-guide.md §1.2) | "다시 시도" 버튼 |
| 온톨로지 그래프 조회 실패 | GraphViewer 영역에 에러: "온톨로지 데이터를 불러오지 못했습니다." | "다시 시도" 버튼 |
| 경로 탐색 실패 | PathResult 영역 에러 | 다른 소스/타겟 선택 유도 |
| HITL 개체 승인/거부 실패 | 토스트 에러 + 개체 상태 복원 | 재시도 |
| 노드 수 초과 (1000+) | 경고 배너: "노드가 많아 필터를 적용하여 일부만 표시합니다." | 계층/검색 필터 안내 |

### 8.2 빈 상태

| 시나리오 | UI 표시 |
|---------|---------|
| 온톨로지 없음 (추출 전) | EmptyState: 🧬 아이콘 + "아직 온톨로지가 추출되지 않았습니다" + [문서 관리로 이동] 링크 |
| 검색 결과 없음 | "'{query}'에 해당하는 개체가 없습니다." |
| 경로 없음 (두 노드 간) | "선택한 두 개체 사이에 연결 경로가 없습니다." |
| 특정 계층 필터 결과 없음 | "'{layer}' 계층에 개체가 없습니다." |

### 8.3 로딩 상태

| 시나리오 | UI 표시 |
|---------|---------|
| 그래프 초기 로드 | GraphViewer 중앙 스피너 + "온톨로지를 불러오는 중..." |
| 노드 클릭 → 상세 조회 | PropertyPanel Skeleton (속성 5줄) |
| 경로 탐색 계산 | PathResult Skeleton + "경로 탐색 중..." |
| 계층 전환 (필터 변경) | 그래프 opacity 50% + 스피너 오버레이 |

---

## 9. 역할별 접근 제어 (RBAC)

### 9.1 기능별 역할 권한

| 기능 | 필요 권한 | admin | manager | attorney | analyst | engineer | staff | viewer |
|------|----------|:-----:|:-------:|:--------:|:-------:|:--------:|:-----:|:------:|
| 온톨로지 그래프 조회 | `ontology:read` | O | O | O | O | O | O | O |
| 노드 검색/경로 탐색 | `ontology:read` | O | O | O | O | O | O | O |
| 계층 필터링/깊이 조절 | `ontology:read` | O | O | O | O | O | O | O |
| 테이블 뷰 조회 | `ontology:read` | O | O | O | O | O | O | O |
| HITL 개체 승인/거부 | `ontology:manage` | O | X | X | X | O | X | X |
| 온톨로지 수동 편집 | `ontology:manage` | O | X | X | X | O | X | X |
| 프로세스 디자이너로 이동 | `case:read` | O | O | O | O | O | O | O |

### 9.2 프론트엔드 가드

```typescript
// 온톨로지 브라우저는 모든 역할이 조회 가능 (ontology:read)
// HITL 승인/거부 버튼은 ontology:manage 권한에만 표시
const { hasPermission } = usePermission();
const canManageOntology = hasPermission('ontology:manage');

// NodeDetail 패널 내
{canManageOntology && extractionStatus === 'pending_review' && (
  <>
    <Button onClick={confirmEntity}>승인</Button>
    <Button variant="destructive" onClick={rejectEntity}>거부</Button>
  </>
)}
```

> **SSOT**: `services/core/docs/07_security/auth-model.md` §2.3
> **HITL 컨텍스트**: HITL 승인/거부는 Synapse 추출 결과 검토이다. 케이스 reviewer 역할이 추가로 필요할 수 있으나, 온톨로지 자체가 케이스 독립적이므로 시스템 역할(`ontology:manage`)을 기준으로 한다.

---

## 10. K-AIR 전환 노트

| K-AIR (data-platform-olap) | Canvas | 전환 노트 |
|----------------------------|--------|-----------|
| `DataLineage.vue` | GraphViewer | Mermaid 정적 -> Force Graph 인터랙티브 |
| Mermaid.js 렌더링 | react-force-graph-2d | 정적 다이어그램 -> 동적 시뮬레이션 |
| Neo4j 직접 쿼리 | Synapse API | 프론트엔드가 DB 직접 접근 안함 |
| 데이터 리니지 뷰 | 온톨로지 4계층 뷰 | 리니지는 하위 기능으로 포함 |

---

## 결정 사항 (Decisions)

- react-force-graph-2d 사용 (Mermaid, Cytoscape 대체)
  - 근거: WebGL 성능, React 네이티브, 대량 노드 처리
  - 대안: @antv/g6 (과잉 기능), vis.js (React 통합 약함)

- 노드 1000개 이상 시 서버 사이드 필터링 필수
  - 근거: 클라이언트 렌더링 성능 한계
  - Synapse API depth 파라미터로 제한

---

## 변경 이력

| 날짜 | 버전 | 작성자 | 내용 |
|------|------|--------|------|
| 2026-02-20 | 1.3 | Axiom Team | RBAC 역할별 접근 제어(§9) 추가 |
| 2026-02-20 | 1.2 | Axiom Team | 접근성(§7), UX 상태 설계(§8) 추가 |
| 2026-02-20 | 1.1 | Axiom Team | 비즈니스 프로세스 디자이너 연동 섹션 추가 (EventStorming-온톨로지 매핑, 상호 내비게이션) |
| 2026-02-19 | 1.0 | Axiom Team | 초기 작성 |
