# ADR-001: scipy.optimize 기반 시나리오 솔버 선택

## 상태

Accepted

## 배경

What-if 시뮬레이션 엔진에서 비즈니스 시나리오를 최적화하기 위한 수리 최적화 라이브러리를 선택해야 한다. 전략 수립 시 다양한 제약조건(정책 최소 성과율, 운영자금, DSCR 등)을 충족하면서 이해관계자 성과율을 최대화하는 실행 계획을 찾아야 한다.

### 요구사항

- 비선형 제약조건 지원 (DSCR 등)
- 경계 제약(bound constraints) 지원
- Python 네이티브
- 중소 규모 문제 (변수 10~50개, 제약 5~20개) 적합
- 결정적(deterministic) 결과 (동일 입력 → 동일 출력)
- 설치 용이성 (추가 시스템 의존성 최소)

## 고려한 옵션

### 1. scipy.optimize (SLSQP)

- **장점**: Python 표준 과학 라이브러리, 설치 간단, SLSQP 메서드가 비선형 제약 지원, 커뮤니티 방대, 문서 풍부
- **단점**: 대규모 문제(변수 1000+)에 비효율, GPU 가속 없음

### 2. Google OR-Tools

- **장점**: 대규모 조합 최적화에 강력, Google 유지보수
- **단점**: 설치 복잡 (C++ 바인딩), 비선형 제약 미흡, 비즈니스 도메인 문제는 조합 최적화보다 연속 최적화에 가까움

### 3. PuLP + CBC

- **장점**: 선형 계획법(LP) 전용, 사용법 간단
- **단점**: 비선형 제약 미지원 (DSCR, 복합 현금흐름 공식), LP로 환원 가능한 문제만 해결

### 4. cvxpy

- **장점**: 볼록 최적화 전문, 학술적으로 검증
- **단점**: 비볼록 문제 미지원 (비즈니스 도메인 일부 제약은 비볼록), 학습 곡선 높음

### 5. Pyomo

- **장점**: 범용 최적화 모델링 프레임워크, 다양한 솔버 백엔드 지원
- **단점**: 과도한 추상화 (우리 문제 규모에 비해), 외부 솔버(IPOPT 등) 별도 설치 필요

## 선택한 결정

**scipy.optimize (SLSQP 메서드)**

## 근거

1. **문제 규모 적합성**: 비즈니스 시나리오는 변수 10~50개, 제약 5~20개의 중소 규모 비선형 최적화 문제. scipy.optimize의 SLSQP가 이 규모에 최적.

2. **비선형 제약 지원**: DSCR >= 1.0, 현금흐름 균형 등 비선형 제약조건을 자연스럽게 표현 가능.

3. **설치 용이성**: `pip install scipy`로 완료. Docker 이미지에 추가 시스템 패키지 불필요.

4. **팀 숙련도**: Python 데이터 과학 표준 라이브러리로 팀 모두 사용 경험 보유.

5. **결정적 결과**: 동일 초기값 + 동일 파라미터 → 동일 결과. 공식 보고서에 사용되는 실행 계획의 재현성 보장.

6. **Fallback 옵션**: 선형 문제로 단순화 가능한 경우 `scipy.optimize.linprog`로 전환 용이.

## 결과

### 긍정적 영향

- 빠른 개발 착수 가능 (기존 라이브러리, 추가 학습 최소)
- Docker 이미지 크기 최소 (추가 C++ 의존성 없음)
- 솔버 로직의 단위 테스트 용이

### 부정적 영향

- 대규모 문제(변수 1000+) 시 성능 저하 가능 → 현재 문제 규모에서는 해당 없음
- GPU 가속 불가 → 현재 필요 없음

## 재평가 조건

- 시나리오 변수가 100개 이상으로 증가할 때
- 솔버 실행 시간이 일관되게 30초 이상일 때
- 조합 최적화 문제(자산 매각 조합 최적화)가 핵심 요구사항이 될 때
- 실시간 대화형 최적화가 필요할 때 (현재는 비동기 배치)

---

## 증거

- 01_architecture/what-if-engine.md Section 3
- 03_backend/scenario-solver.md (SLSQP 구현 상세)
